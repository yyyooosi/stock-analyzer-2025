# APIãŒå‹•ä½œã—ãªã„å ´åˆã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

FMP APIã®ã‚³ãƒ¼ãƒ«æ•°ãŒå¢—ãˆãªã„å ´åˆã®è¨ºæ–­ãƒ»è§£æ±ºæ–¹æ³•ã§ã™ã€‚

## ğŸ” å•é¡Œã®è¨ºæ–­

### ã‚¹ãƒ†ãƒƒãƒ—1: è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ

```bash
# FMP_API_KEYã‚’è¨­å®šã—ã¦è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
export FMP_API_KEY=your_actual_api_key_here
npx tsx scripts/test-fmp-api.ts
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:
```
=== FMP API è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ===

âœ… FMP_API_KEY: abcd...wxyz

ğŸ“Š ãƒ†ã‚¹ãƒˆ1: Quote API (ãƒãƒƒãƒ)
   ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 200 OK
   âœ… æˆåŠŸ: 3ä»¶ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®çµæœã«å¿œã˜ã¦ã€ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«é€²ã‚“ã§ãã ã•ã„ã€‚

---

## âŒ ã‚¨ãƒ©ãƒ¼: "FMP_API_KEYãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"

### åŸå› 
ç’°å¢ƒå¤‰æ•° `FMP_API_KEY` ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

### è§£æ±ºæ–¹æ³•

#### æ–¹æ³•1: .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼ˆæ¨å¥¨ï¼‰

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ:
   ```bash
   cp .env.example .env
   ```

2. `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦APIã‚­ãƒ¼ã‚’è¿½åŠ :
   ```env
   FMP_API_KEY=your_actual_api_key_here
   ```

3. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•:
   ```bash
   npm run dev
   ```

#### æ–¹æ³•2: ç’°å¢ƒå¤‰æ•°ã‚’ç›´æ¥è¨­å®š

```bash
# Linuxin/Mac
export FMP_API_KEY=your_actual_api_key_here
npm run dev

# Windows (PowerShell)
$env:FMP_API_KEY="your_actual_api_key_here"
npm run dev
```

#### æ–¹æ³•3: Vercel/æœ¬ç•ªç’°å¢ƒ

1. Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š â†’ Environment Variables
3. `FMP_API_KEY` ã‚’è¿½åŠ ã—ã¦å€¤ã‚’è¨­å®š
4. å†ãƒ‡ãƒ—ãƒ­ã‚¤

### APIã‚­ãƒ¼ã®å–å¾—æ–¹æ³•

1. https://financialmodelingprep.com/developer/docs ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆï¼ˆç„¡æ–™ï¼‰
3. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰APIã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼

---

## âŒ ã‚¨ãƒ©ãƒ¼: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 401 Unauthorized"

### åŸå› 
APIã‚­ãƒ¼ãŒç„¡åŠ¹ã¾ãŸã¯é–“é•ã£ã¦ã„ã‚‹

### è§£æ±ºæ–¹æ³•

1. **APIã‚­ãƒ¼ã‚’å†ç¢ºèª**:
   - FMPãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§æ­£ã—ã„APIã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼
   - ã‚¹ãƒšãƒ¼ã‚¹ã‚„æ”¹è¡ŒãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ç¢ºèª

2. **APIã‚­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ**:
   ```bash
   # ãƒ–ãƒ©ã‚¦ã‚¶ã¾ãŸã¯curlã§ç›´æ¥ãƒ†ã‚¹ãƒˆ
   curl "https://financialmodelingprep.com/api/v3/quote/AAPL?apikey=YOUR_KEY"
   ```

3. **æ­£ã—ã„å½¢å¼ã§è¨­å®š**:
   ```env
   # âœ… æ­£ã—ã„
   FMP_API_KEY=abc123xyz456

   # âŒ é–“é•ã„ï¼ˆå¼•ç”¨ç¬¦ä¸è¦ï¼‰
   FMP_API_KEY="abc123xyz456"
   FMP_API_KEY='abc123xyz456'
   ```

---

## âŒ ã‚¨ãƒ©ãƒ¼: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 429 Too Many Requests"

### åŸå› 
APIãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™ã‚’è¶…éï¼ˆç„¡æ–™ãƒ—ãƒ©ãƒ³: 250ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ—¥ï¼‰

### è§£æ±ºæ–¹æ³•

1. **ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèª**:
   - https://financialmodelingprep.com/developer/docs/dashboard
   - ä»Šæ—¥ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’ç¢ºèª

2. **ãƒªã‚»ãƒƒãƒˆã‚’å¾…ã¤**:
   - 12:00 AM UTC ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹
   - æ—¥æœ¬æ™‚é–“: åˆå‰9æ™‚

3. **ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ¤œè¨**:
   - Starter Plan: 500ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ—¥ (~$14/æœˆ)
   - Professional Plan: ç„¡åˆ¶é™ (~$99/æœˆ)

---

## âŒ ã‚¨ãƒ©ãƒ¼: "fetch failed" ã¾ãŸã¯ "ECONNREFUSED"

### åŸå› 
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å•é¡Œ

### è§£æ±ºæ–¹æ³•

1. **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèª**:
   ```bash
   # FMPã‚µãƒ¼ãƒãƒ¼ã«åˆ°é”ã§ãã‚‹ã‹ç¢ºèª
   ping financialmodelingprep.com
   ```

2. **ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«/ãƒ—ãƒ­ã‚­ã‚·ã‚’ç¢ºèª**:
   - `financialmodelingprep.com` ãŒè¨±å¯ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - HTTPSãƒãƒ¼ãƒˆ443ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª

3. **DNSã‚’ç¢ºèª**:
   ```bash
   # DNSè§£æ±ºã‚’ç¢ºèª
   nslookup financialmodelingprep.com
   ```

---

## âš ï¸ å•é¡Œ: APIã‚³ãƒ¼ãƒ«æ•°ãŒå¢—ãˆã¦ã„ãªã„

### è€ƒãˆã‚‰ã‚Œã‚‹åŸå› 

#### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ·å‹•ã—ã¦ã„ãªã„

**ç¢ºèªæ–¹æ³•**:
```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
ps aux | grep "next dev"
```

**è§£æ±ºæ–¹æ³•**:
```bash
npm run dev
```

#### 2. ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ãªã„

**ç¢ºèªæ–¹æ³•**:
- ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:3000/screener` ã‚’é–‹ã
- ãƒšãƒ¼ã‚¸ãŒè‡ªå‹•çš„ã«APIã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼ˆuseEffectã§è‡ªå‹•å®Ÿè¡Œï¼‰

#### 3. ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦APIã‚³ãƒ¼ãƒ«ãŒå¤±æ•—ã—ã¦ã„ã‚‹

**ç¢ºèªæ–¹æ³•**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãï¼ˆF12ã‚­ãƒ¼ï¼‰
2. Consoleã‚¿ãƒ–ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
3. Networkã‚¿ãƒ–ã§ `/api/screener` ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèª

**ä¸€èˆ¬çš„ãªã‚¨ãƒ©ãƒ¼**:
- `500 Internal Server Error`: ã‚µãƒ¼ãƒãƒ¼å´ã®ã‚¨ãƒ©ãƒ¼
- `CORS error`: CORSè¨­å®šã®å•é¡Œï¼ˆNext.jsã§ã¯é€šå¸¸ç™ºç”Ÿã—ãªã„ï¼‰
- `Network error`: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å•é¡Œ

#### 4. ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹

**ç¢ºèªæ–¹æ³•**:
```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãƒ­ã‚°ã‚’ç¢ºèª
# ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¢ã™
```

**ä¸€èˆ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
```
[Screener] FMP_API_KEY is NOT configured
â†’ ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

TypeError: Cannot read property 'length' of undefined
â†’ APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæœŸå¾…ã—ãŸå½¢å¼ã§ã¯ãªã„

fetch failed
â†’ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚¨ãƒ©ãƒ¼
```

---

## ğŸ”§ ãƒ‡ãƒãƒƒã‚°æ‰‹é †

### 1. åŸºæœ¬çš„ãªç¢ºèª

```bash
# 1. ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
echo $FMP_API_KEY

# 2. .envãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
cat .env | grep FMP_API_KEY

# 3. è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
FMP_API_KEY=your_key npx tsx scripts/test-fmp-api.ts
```

### 2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã§ãƒ†ã‚¹ãƒˆ

```bash
# 1. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
npm run dev

# 2. åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§APIã‚’ç›´æ¥ãƒ†ã‚¹ãƒˆ
curl http://localhost:3000/api/screener | jq .

# 3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹
# http://localhost:3000/screener
```

### 3. ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–

`app/api/screener/route.ts` ã§è©³ç´°ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™:

```
[Screener] Starting stock data fetch...
[Screener] FMP_API_KEY is configured: f3FJ...kGdy
[FMP] Fetching stocks from FMP API...
[FMP] Got 1000 stocks from screener
```

ã“ã‚Œã‚‰ã®ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆ:
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ·å‹•ã—ã¦ã„ãªã„
- APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå‘¼ã°ã‚Œã¦ã„ãªã„

---

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

APIãŒæ­£ã—ãå‹•ä½œã™ã‚‹ãŸã‚ã®å®Œå…¨ãªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:

- [ ] FMP APIã‚­ãƒ¼ã‚’å–å¾—ã—ãŸ
- [ ] `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ãŸ
- [ ] `.env` ã« `FMP_API_KEY=...` ã‚’è¿½åŠ ã—ãŸ
- [ ] é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’ï¼ˆå†ï¼‰èµ·å‹•ã—ãŸ (`npm run dev`)
- [ ] è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæˆåŠŸã™ã‚‹ (`npx tsx scripts/test-fmp-api.ts`)
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:3000/screener` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸ
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¨ãƒ©ãƒ¼ãŒãªã„ï¼ˆF12ã§ç¢ºèªï¼‰
- [ ] ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã«ã‚¨ãƒ©ãƒ¼ãŒãªã„
- [ ] FMPãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§APIã‚³ãƒ¼ãƒ«æ•°ãŒå¢—åŠ ã—ã¦ã„ã‚‹

---

## ğŸ†˜ ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆ

### ã‚µãƒãƒ¼ãƒˆæƒ…å ±ã®åé›†

ä»¥ä¸‹ã®æƒ…å ±ã‚’åé›†ã—ã¦GitHub Issuesã§å ±å‘Šã—ã¦ãã ã•ã„:

1. **è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‡ºåŠ›**:
   ```bash
   FMP_API_KEY=your_key npx tsx scripts/test-fmp-api.ts 2>&1 | tee diagnostic.log
   ```

2. **ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°**:
   ```bash
   npm run dev 2>&1 | tee server.log
   ```

3. **ç’°å¢ƒæƒ…å ±**:
   ```bash
   node --version
   npm --version
   cat package.json | grep "next"
   ```

4. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ã‚¨ãƒ©ãƒ¼** (F12 â†’ Console)

5. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ­ã‚°** (F12 â†’ Network â†’ `/api/screener`)

### GitHub Issueã‚’ä½œæˆ

https://github.com/yyyooosi/stock-analyzer-2025/issues/new

ã‚¿ã‚¤ãƒˆãƒ«: `[Bug] FMP API not working: <ç°¡æ½”ãªèª¬æ˜>`

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ:
```markdown
## å•é¡Œã®èª¬æ˜
<ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹>

## å†ç¾æ‰‹é †
1. ...
2. ...

## æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ
<æœ¬æ¥ã©ã†ã‚ã‚‹ã¹ãã‹>

## ç’°å¢ƒæƒ…å ±
- Node.js: vX.X.X
- Next.js: vX.X.X
- OS: <Windows/Mac/Linux>

## ãƒ­ã‚°/ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
```
<è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‡ºåŠ›>
<ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°>
<ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ã‚¨ãƒ©ãƒ¼>
```

## è©¦ã—ãŸã“ã¨
- [ ] è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
- [ ] .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
- [ ] APIã‚­ãƒ¼ã‚’å†ç¢ºèª
- [ ] ...
```

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [FMP API Setup Guide](./FMP_API_SETUP.md) - è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰
- [Screening API Guide](./SCREENING_API_GUIDE.md) - ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°APIã®ä½¿ã„æ–¹
- [Screening API Fix](./SCREENING_API_FIX.md) - æœ€è¿‘ã®ä¿®æ­£å†…å®¹
